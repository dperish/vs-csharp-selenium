using OpenQA.Selenium.Support.UI;
using OpenQA.Selenium;

namespace MyApp.UiTests.Extensions;
public static class WebDriverExtensions
{
    /// <summary>
    /// Find an element, waiting until a timeout is reached if necessary.
    /// </summary>
    /// <param name="context">The search context.</param>
    /// <param name="by">Method to find elements.</param>
    /// <param name="timeout">How many seconds to wait.</param>
    /// <param name="displayed">Require the element to be displayed?</param>
    /// <returns>The found element.</returns>
    public static IWebElement FindElement(this ISearchContext context, By by, TimeSpan timeout, bool displayed = false)
    {
        var wait = new DefaultWait<ISearchContext>(context);
        wait.Timeout = timeout;
        wait.IgnoreExceptionTypes(typeof(NoSuchElementException));
        return wait.Until(ctx => {
            var elem = ctx.FindElement(by);
            if (displayed && !elem.Displayed)
                return null;

            return elem;
        })!;
    }
}